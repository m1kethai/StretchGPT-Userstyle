/* ==UserStyle==
@name           StretchGPT: Extra Wide ChatGPT Conversations
@version        6.0
@author         m1kethai
@description    Improves ChatGPT conversation readability by removing the narrow fixed content width and replacing it with subtle, adaptive padding for a consistent UX across all screen sizes.
@namespace      https://github.com/m1kethai/StretchGPT-Userstyle
@preprocessor   less
@var checkbox   hideAvatars              "Hide ChatGPT avatar (allows message contents to expand a bit further)" 0
@var checkbox   enableColorize           "Enable color customizations (all color-related features below will be ignored if this is turned off)" 0
@var checkbox   colorizePromptElements   "Apply custom colors to the input/prompt component" 1
@var checkbox   colorizeUserMessages     "Apply custom color to your message bubbles" 1
@var checkbox   colorizeUserMessagesFull "  â¤· Colorize the message bubble + the background of the whole chat entry behind it" 0
@var select     customColor       "Select color preset" {
	"Aged Sage*":          "#8da572",
	"Akira":               "#840000",
	"Amaretto":            "#ab6f60",
	"Ancient Gold":        "#b59410",
	"Aztek":               "#293432",
	"Black Pearl":         "#1e272c",
	"Black Sabbath":       "#220022",
	"Blue Moss":           "#5D737E",
	"Cardamom":            "#aaaa77",
	"Caviar":              "#292a2d",
	"Cyber Grape":         "#58427C",
	"Cyprus":              "#545a3e",
	"Dark and Stormy":     "#353f51",
	"Deep Jungle":         "#1A2421",
	"Deep Space":          "#2D3142",
	"Dusty Turquoise":     "#5a8a89",
	"Earl Grey":           "#a6978a",
	"Emerald":             "#0f380f",
	"FF06B5":              "#FF06B5",
	"Gameboy Teal":        "#0ABFBC",
	"Japanese Violet":     "#5B3256",
	"Lobster Bisque":      "#FFDAB9",
	"Obsidian Ash":        "#343434",
	"Purple Haze":         "#807396",
	"Raichu":              "#fc8c2c",
	"Sakura Bloom":        "#ff7b9c",
	"Sharp Indigo":        "#48007c",
	"Super Blue Lavender": "#5a5b9f",
	"Tokyo Midnight":      "#1a1a2e",
}

==/UserStyle== */
@-moz-document domain("chatgpt.com") {
	html {
		/* INIT ---------- */
		.set-breakpoints() {
			@sm: ~"screen and (min-width: 0px) and (max-width: 767px)";
			@sm-max: ~"screen and (max-width: 767px)";
			@md: ~"screen and (min-width: 768px) and (max-width: 1023px)";
			@md-up: ~"screen and (min-width: 768px)";
			@md-max: ~"screen and (max-width: 1023px)";
			@lg: ~"screen and (min-width: 1024px) and (max-width: 1535px)";
			@lg-up: ~"screen and (min-width: 1024px)";
			@lg-max: ~"screen and (max-width: 1535px)";
			@xl: ~"screen and (min-width: 1536px) and (max-width: 3839px)";
			@xl-up: ~"screen and (min-width: 1536px)";
			@xl-max: ~"screen and (max-width: 3839px)";
			@xxl: ~"screen and (min-width: 3840px)";
		}
		.set-selectors() {
			@-sidebar:               .flex-shrink-0.overflow-x-hidden.bg-token-sidebar-surface-primary;
			@-header:                .sticky.top-0.z-10;
			@-chat:                  @{-sidebar} + div:last-child > main;
			@-chat__entry:           @{-header} ~ div:has(.group\/conversation-turn);
			@-chat__entry__inner--1: @{-chat__entry} > div;
			@-chat__entry__inner--2: @{-chat__entry} .md\:max-w-3xl;
			@-chat__entry--user:     @{-chat__entry}:not(:has(.agent-turn));
			@-chat__entry--gpt:      @{-chat__entry}:has(div[data-message-author-role="assistant"]);
			@-chat__prompt:          @{-chat} form .max-w-full .w-full.flex.flex-col.transition-colors;
			@-footer:                @{-sidebar} + div:last-child > div:last-child;

			@-sm--chat__entry--gpt:  @{-sm--chat__entry}:has(div[data-message-author-role="assistant"]);
			@-sm--chat__entry--user: @{-sm--chat__entry} div[data-message-author-role="user"];
			@-sm--chat:              @{-header} ~ main div.flex-1.overflow-hidden;
			@-sm--chat__entry:       @{-sm--chat} div.w-full:has(.group\/conversation-turn);
			@-sm--chat__prompt:      @{-header} ~ main form div.rounded-\[26px\];
			@-sm--footer:            @{-sm--chat} ~ div.w-full;
		}
		.set-breakpoints();
		.set-selectors();
		/* ---------- INIT */

		& when(@enableColorize =1) {
			&.dark { .colorize(dark)}
			&.light { .colorize(light)}
		}

		/* CORE FUNCTIONALITY ***************************/

		@{-chat__entry__inner--2} {
			max-width: 100% !important;
		}

		/* FEATURE: HIDE AVATARS ************************/

		& when(@hideAvatars =1) {
			@-avatar: .flex-shrink-0.flex.flex-col.relative.items-end;

			@{-chat__entry--gpt},
			@{-sm--chat__entry--gpt} {
				@{-avatar} { display: none }
			}

			/* add back some padding */
			@{-chat__entry--gpt} > div {
				padding-left: var(--pl) !important;
				@media @sm {
					--pl: max(calc(1vw*1rem), 1rem);
					display: none !important;
				};
				@media @md-up {
					--pl: max(calc(1.5vw*1rem), 1.5rem);
					@media @xl-up {
						--pl: max(calc(2vw*1rem), 2rem);
					}
				}
			}
		}

		/* FEATURE: CUSTOM COLORIZATION *****************/

		#colorLib() {
			.defaults(dark) {
				@colors: {
					@bg: #212121; /* '--main-surface-primary', '--gray-800' */
					@text: #ececec; /* '--text-primary', '--gray-100' */
				}
			} .defaults(light) {
				@colors: {
					@bg: white; /* '--main-surface-primary', '--gray-100' */
					@text: #0d0d0d; /* '--text-primary', '--gray-950' */
				}
			}

			.bgTint(@theme, @base) {
				@sat: round(saturation(@blended));
				@blended: if(
					@theme =light,
					mix(@base, @customColor, 90%),
					if(
						luma(@customColor) < 5%,
						@customColor,
						mix(@base, @customColor, 70%)
					)
				);
				@faded: fadeout(@blended,
					if(@sat <= 55%, 0%,
						if(@sat < 70%, 40%,
							if(@sat < 90%, 50%,
								60%
							)
						)
					), relative
				);
				@result: if(@theme =light, @blended, @faded);
			}

			.accessible-fg-color(@bg, @light: #ececec, @dark: #0d0d0d) {
				/* set text/foreground to a light or dark preset color based on its contrast against the element's bg (using the default 43% threshold) */
				@result: contrast(@bg, @light, @dark);
			}
		}

		.colorize(@theme: dark) {
			// @base-colors: if(@theme =dark, #colorLib.defaults(dark)[], #colorLib.defaults(light)[]);
			@base-colors: #colorLib.defaults(@theme)[];
			@tinted-bg-color: #colorLib.bgTint(@theme, @base-colors[@bg])[];
			@accessible-text-color: #colorLib.accessible-fg-color(@tinted-bg-color)[];

			.apply() {
				background-color: @tinted-bg-color !important;
				color: @accessible-text-color !important;
			}

			& when (@colorizePromptElements =1) {
				@media @sm-max {
					@{-sm--chat__prompt} {.apply()}
				} @media @md-up {
					@{-chat__prompt} {.apply()}
				}

				@{-sm--chat__prompt}, @{-chat__prompt} {
					button.rounded-full {
						&[disabled] {
							color: fadeout(@accessible-text-color, 65%);
							background-color: fadeout(@accessible-text-color, 85%) !important;
						} &:not([disabled]) {
							color: @accessible-text-color;
							background-color: inherit;
						}
					}
				}
			}

			& when (@colorizeUserMessages =1) {
				@-msg-bubble: .relative.rounded-3xl;
				@media @sm-max {
					@{-sm--chat__entry--user} {
						/* only allowing the bubble to be colorized @ the smallest breakpoint for now (doesn't look too great a lot of the time) */
						@{-msg-bubble} {.apply()}
					}
				} @media @md-up {
					@{-chat__entry--user} {
						& when (@colorizeUserMessagesFull =1) {
							.apply();
							@{-msg-bubble} {
								@softBg: fade(softlight(@customColor, @tinted-bg-color), 50%);
								background-color: @softBg;
							}
						}
						& when (@colorizeUserMessagesFull =0) {
							@{-msg-bubble} {
								.apply();
							}
						}
					}
				}
			}
		}

		/* MISC. UI FIXES/ENHANCEMENTS ******************/
		/* fixes recent UI bug where the left side of <ol> numbers are cut off in responses */
		@{-chat__entry--gpt} .prose :where(ol):not(:where([class~="not-prose"] *)) {
			padding-left: 1.85em;
		}
	}
}
